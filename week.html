<html>
<body style="margin:0; display:flex; justify-content:center; align-items:center; height:100vh; overflow:hidden;">
<span id="weekspan"></span>
<script>
let termBreakAfterWeek = 8;
let termNumberOfWeeks = 13;
//let termStartDate = "2025-08-04";
let term1StartWeek = 8;
let term2StartWeek = 31;
let term1BreakAfterWeek = 6;
let term2BreakAfterWeek = 8;
let fontColour = "e64626";
let font = "Lato, sans-serif";
let fontSize = "18pt";
let beforeText = "";
let afterText = "";

let urlParams = new URLSearchParams(window.location.search);
//if(urlParams.get('termStartDate')){termStartDate = urlParams.get('termStartDate') };
//if(urlParams.get('termBreakAfterWeek')){termBreakAfterWeek = urlParams.get('termBreakAfterWeek') };
if(urlParams.get('termNumberOfWeeks')){termNumberOfWeeks = urlParams.get('termNumberOfWeeks') };
if(urlParams.get('beforeText')){beforeText = urlParams.get('beforeText') };
if(urlParams.get('afterText')){afterText = urlParams.get('afterText') };
if(urlParams.get('fontSize')){fontSize = urlParams.get('fontSize') };
if(urlParams.get('fontColour')){fontColour = urlParams.get('fontColour') };
if(urlParams.get('font')){font = urlParams.get('font') };

function getWeekInYear(date) {
  const now = new Date();
  const epoch = new Date(now.getFullYear(), 0, 1);
  epoch.setDate(epoch.getDate() - ((7 - epoch.getDay()) % 7));
  let d = date instanceof Date ? date : new Date(date);
  let diffMs = d.getTime() - epoch.getTime();
  return Math.floor(diffMs / (7 * 24 * 60 * 60 * 1000));
}

function getWeeksSinceEpoch(date, epoch = new Date("1970-01-04T14:00:00Z")) {
  let d = date instanceof Date ? date : new Date(date);
  let diffMs = d.getTime() - epoch.getTime();
  return Math.floor(diffMs / (7 * 24 * 60 * 60 * 1000));
}

//let termStartWeek = getWeeksSinceEpoch(new Date(termStartDate));
//let weekInYear = getWeeksSinceEpoch(new Date());
let weekInYear = getWeekInYear(new Date());
let termStartWeek = term1StartWeek;
let termNumber = 1;
if (weekInYear >= 26){
  termStartWeek = term2StartWeek;
  termNumber = 2;
  termBreakAfterWeek = term2BreakAfterWeek;
};
let weekInThisTerm = weekInYear - termStartWeek + 1;
let termBreakAfterWeekOffset = weekInThisTerm > termBreakAfterWeek;
let weekInTerm = weekInThisTerm - termBreakAfterWeekOffset;

let outputString = `${beforeText} Week ${weekInTerm} ${afterText}`;

if (weekInTerm < 1){outputString = `${beforeText} Before Start of Semester`}
if (weekInThisTerm == termBreakAfterWeek + 1){outputString = `${beforeText} Break Week ${afterText}`}
if (weekInTerm == termNumberOfWeeks + 1){outputString = `${beforeText} STUVAC ${afterText}`}
if (weekInTerm == termNumberOfWeeks + 2){outputString = `${beforeText} Week 1 Exam Period ${afterText}`}
if (weekInTerm == termNumberOfWeeks + 3){outputString = `${beforeText} Week 2 Exam Period ${afterText}`}
if (weekInTerm > termNumberOfWeeks + 3){outputString = `${beforeText} End of Semester`}

//document.write(`<span style="color: ${fontColour} ;font-family: ${font};font-size: ${fontSize}">${outputString}</span>`);
const outputElement = document.getElementById('weekspan');
outputElement.innerHTML = outputString;
outputElement.style.fontWeight = 'bold';
outputElement.style.fontSize = fontSize;
outputElement.style.fontFamily = font;
outputElement.style.color = fontColour;
  
//console.log('Weeks since epoch = ' + weekInYear );
//console.log('Term starts in week = ' + termStartWeek );
//console.log('Weeks since start of term = ' + weekInThisTerm );
//console.log('Has term break happened yet = ' + termBreakAfterWeekOffset );
//console.log('Term break happens after week = ' + termBreakAfterWeek );
//console.log(termBreakAfterWeek + 1);
//console.log('The current week number is ' + weekInTerm );
</script>
</body>
</html>
